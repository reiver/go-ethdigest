package ethdigest_test

import (
	"testing"

	"fmt"
	"math/big"

	"github.com/reiver/go-ethdigest"
)

func TestDigest_BigInt(t *testing.T) {

	tests := []struct{
		Digest ethdigest.Digest
		Expected *big.Int
	}{
		{
			Digest: ethdigest.Nothing(),
			Expected: nil,
		},



		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00} ),
			Expected: big.NewInt(0),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01} ),
			Expected: big.NewInt(1),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02} ),
			Expected: big.NewInt(2),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03} ),
			Expected: big.NewInt(3),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04} ),
			Expected: big.NewInt(4),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05} ),
			Expected: big.NewInt(5),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06} ),
			Expected: big.NewInt(6),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07} ),
			Expected: big.NewInt(7),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08} ),
			Expected: big.NewInt(8),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x09} ),
			Expected: big.NewInt(9),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0A} ),
			Expected: big.NewInt(10),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0B} ),
			Expected: big.NewInt(11),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C} ),
			Expected: big.NewInt(12),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0D} ),
			Expected: big.NewInt(13),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0E} ),
			Expected: big.NewInt(14),
		},
		{
			Digest: ethdigest.Something( [32]byte{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F} ),
			Expected: big.NewInt(15),
		},



		{
			Digest: ethdigest.Something( [32]byte{0x5a,0xAe,0xb6,0x05,0x3F,0x3E,0x94,0xC9,0xb9,0xA0,0x9f,0x33,0x66,0x94,0x35,0xE7,0xEf,0x1B,0xeA,0xed,0x5a,0xAe,0xb6,0x05,0x3F,0x3E,0x94,0xC9,0xb9,0xA0,0x9f,0x33} ),
			Expected: func() *big.Int {
				var str string = "41016844021060681834146332200510513382994275193248144843952914495687681417011"

				var bigint big.Int
				_, ok := bigint.SetString(str, 10)
				if !ok {
					panic(fmt.Sprintf("could not convert %q to a big.Int", str))
				}
				return &bigint
			}(),
		},



		{
			Digest: ethdigest.Something( [32]byte{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF} ),
			Expected: func() *big.Int {
				var str string = "115792089237316195423570985008687907853269984665640564039457584007913129639935"

				var bigint big.Int
				_, ok := bigint.SetString(str, 10)
				if !ok {
					panic(fmt.Sprintf("could not convert %q to a big.Int", str))
				}
				return &bigint
			}(),
		},
	}

	for testNumber, test := range tests {

		actual := test.Digest.BigInt()

		expected := test.Expected

		if ( (nil == expected || nil == actual) && (expected != actual) )   ||   (0 != expected.Cmp(actual)) {
				t.Errorf("For test #%d, the actual value for the resulting big-int is not what was expected", testNumber)
			t.Logf("EXPECTED: %#v", expected)
			t.Logf("ACTUAL:   %#v", actual)
			t.Logf("DIGEST: %#v", test.Digest)
			continue
		}

	}
}
